<!DOCTYPE html>
<html>

<head>
    <title>uNmINeD</title>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

    <!-- OpenLayers  -->
    <link rel="stylesheet" type="text/css" href="lib/ol.css">
    <script src="lib/ol.js"></script>

    <!-- OpenLayers Context Menu -->
    <link href="lib/ol-contextmenu.css" rel="stylesheet">
    <script src="lib/ol-contextmenu.iife.js"></script>

    <!-- Toastify -->
    <script type="text/javascript" src="lib/toastify-js.js"></script>
    <link rel="stylesheet" type="text/css" href="lib/toastify-js.min.css">

    <!-- Map metadata generated by uNmINeD -->
    <script type="text/javascript" src="unmined.map.properties.js"></script>
    <script type="text/javascript" src="unmined.map.regions.js"></script>
    <script type="text/javascript" src="unmined.map.players.js"></script>

    <!-- Custom markers -->
    <script type="text/javascript" src="custom.markers.js"></script>

    <!-- uNmINeD JS and CSS -->
    <script type="text/javascript" src="unmined.js"></script>
    <link rel="stylesheet" type="text/css" href="index.css">
    
    <style>
        #language-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 8px 12px;
            font-family: Arial, sans-serif;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
            min-width: 44px;
            text-align: center;
        }
        
        #language-toggle:hover {
            background-color: #f5f5f5;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <button id="language-toggle">🇺🇸</button>

    <script type="text/javascript">
        document.title = UnminedMapProperties.worldName + " - " + document.title;

        // Initially set the current language to English
        let currentLanguage = 'en';

        // Get the language toggle button
        const languageToggleBtn = document.getElementById('language-toggle');

        // Language toggle functionality
        languageToggleBtn.addEventListener('click', function() {
            // Toggle between English and Japanese
            currentLanguage = currentLanguage === 'en' ? 'ja' : 'en';
            
            // Update button text with appropriate flag
            languageToggleBtn.textContent = currentLanguage === 'en' ? '🇺🇸' : '🇯🇵';
            
            // Update markers based on selected language
            UnminedCustomMarkers.markers = UnminedCustomMarkers.generateMarkers(currentLanguage);
            
            // Refresh the map with new markers
            if (unmined && unmined.markersLayer) {
                unmined.olMap.removeLayer(unmined.markersLayer);
                unmined.markersLayer = unmined.createMarkersLayer(UnminedCustomMarkers.markers);
                unmined.olMap.addLayer(unmined.markersLayer);
                unmined.updateMarkersLayer();
            }
            
            // Show notification about language change
            Unmined.toast(currentLanguage === 'en' ? "Changed to English" : "日本語に変更しました");
            
            // Store language preference
            if (typeof localStorage !== 'undefined') {
                localStorage.setItem('mapLanguage', currentLanguage);
            }
        });

        // Load saved language preference if available
        if (typeof localStorage !== 'undefined') {
            const savedLanguage = localStorage.getItem('mapLanguage');
            if (savedLanguage) {
                currentLanguage = savedLanguage;
                languageToggleBtn.textContent = currentLanguage === 'en' ? '🇺🇸' : '🇯🇵';
                
                // Update markers based on saved language
                UnminedCustomMarkers.markers = UnminedCustomMarkers.generateMarkers(currentLanguage);
            }
        }

        if (UnminedCustomMarkers && UnminedCustomMarkers.isEnabled && UnminedCustomMarkers.markers) {
            UnminedMapProperties.markers = UnminedMapProperties.markers.concat(UnminedCustomMarkers.markers);
        }
        
        if (UnminedPlayers && UnminedPlayers.length > 0) {
            UnminedMapProperties.playerMarkers = Unmined.createPlayerMarkers(UnminedPlayers);
        }

        const mapElement = document.getElementById('map');
        const unmined = new Unmined(mapElement, UnminedMapProperties, UnminedRegions);
        
        // Make current language available globally
        window.currentLanguage = currentLanguage;
    </script>
</body>

</html>